{% extends "layout.html" %}

{% block title %}Document Management - LLM Training{% endblock %}

{% block head %}
<link href="{{ url_for('static', filename='css/tailwind.css') }}" rel="stylesheet">
<style>
    .view-btn.active {
        background-color: #3B82F6;
        color: white;
    }
    .document-item:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    .dataset-item:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    .loading-spinner {
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
        <!-- Page Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Document Management</h1>
            <p class="mt-2 text-gray-600">Manage your training documents and organize them into datasets</p>
        </div>

        <!-- Document Management Interface -->
        <div id="document-management-container" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <!-- Header with view toggle and actions -->
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-4">
                    <h2 class="text-xl font-semibold text-gray-900">Document Management</h2>
                    <div class="view-toggle bg-gray-100 rounded-lg p-1">
                        <button type="button" class="view-btn active px-3 py-1 text-sm font-medium rounded-md transition-colors" data-view="documents">
                            Documents
                        </button>
                        <button type="button" class="view-btn px-3 py-1 text-sm font-medium rounded-md transition-colors" data-view="datasets">
                            Datasets
                        </button>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button type="button" class="refresh-btn px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                        <svg class="h-4 w-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Refresh
                    </button>
                    <button type="button" class="create-dataset-btn px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 transition-colors">
                        Create Dataset
                    </button>
                </div>
            </div>

            <!-- Search and filters -->
            <div class="flex items-center space-x-4 mb-4">
                <div class="flex-1">
                    <input type="text" class="search-input w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Search documents...">
                </div>
                <select class="filter-select px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="">All Types</option>
                    <option value="pdf">PDF</option>
                    <option value="txt">Text</option>
                    <option value="docx">Word</option>
                    <option value="json">JSON</option>
                </select>
            </div>

            <!-- Bulk actions (hidden by default) -->
            <div class="bulk-actions hidden bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                <div class="flex items-center justify-between">
                    <span class="text-sm text-blue-700">
                        <span class="selected-count">0</span> documents selected
                    </span>
                    <div class="flex items-center space-x-2">
                        <button type="button" class="add-to-dataset-btn px-3 py-1 text-xs font-medium text-blue-700 bg-blue-100 rounded hover:bg-blue-200 transition-colors">
                            Add to Dataset
                        </button>
                        <button type="button" class="bulk-delete-btn px-3 py-1 text-xs font-medium text-red-700 bg-red-100 rounded hover:bg-red-200 transition-colors">
                            Delete Selected
                        </button>
                        <button type="button" class="clear-selection-btn px-3 py-1 text-xs font-medium text-gray-700 bg-gray-100 rounded hover:bg-gray-200 transition-colors">
                            Clear Selection
                        </button>
                    </div>
                </div>
            </div>

            <!-- Documents view -->
            <div class="documents-view">
                <div class="documents-list space-y-3">
                    <!-- Documents will be rendered here -->
                </div>
            </div>

            <!-- Datasets view (hidden by default) -->
            <div class="datasets-view hidden">
                <div class="datasets-list space-y-3">
                    <!-- Datasets will be rendered here -->
                </div>
            </div>

            <!-- Loading state -->
            <div class="loading-state hidden flex items-center justify-center py-12">
                <div class="loading-spinner rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                <span class="ml-3 text-gray-600">Loading...</span>
            </div>

            <!-- Empty state -->
            <div class="empty-state hidden text-center py-12">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">No documents</h3>
                <p class="mt-1 text-sm text-gray-500">Get started by uploading your first document.</p>
            </div>
        </div>

        <!-- Success/Error Messages -->
        <div id="message-container" class="fixed top-4 right-4 z-50"></div>
    </div>
</div>

<!-- Modals will be inserted here dynamically -->
<div id="modal-container"></div>

<script src="{{ url_for('static', filename='js/document-management.js') }}"></script>
<script>
    // Initialize document management when page loads
    document.addEventListener('DOMContentLoaded', function() {
        const container = document.getElementById('document-management-container');
        if (container) {
            window.documentManagement = new DocumentManagement({
                container: container,
                apiBaseUrl: '/api',
                onDocumentDeleted: function(documentId) {
                    console.log('Document deleted:', documentId);
                },
                onDatasetCreated: function(dataset) {
                    console.log('Dataset created:', dataset);
                },
                onDatasetUpdated: function(dataset) {
                    console.log('Dataset updated:', dataset);
                },
                onError: function(error) {
                    console.error('Document management error:', error);
                }
            });
        }
    });
</script>
{% endblock %}